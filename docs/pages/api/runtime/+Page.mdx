import { PackageInfo, InstallCommand, ApiReference, NextSteps } from '../../../components'

<PackageInfo
  name="@photonjs/runtime"
  description="The runtime package provides convenience functions for framework developers to integrate Photon."
  status="alpha"
  npmUrl="https://www.npmjs.com/package/@photonjs/runtime"
  githubUrl="https://github.com/photon-js/photon/tree/main/packages/runtime"
/>

<InstallCommand packages="@photonjs/runtime" />

## Exports

### `./vite`

Vite integration functions for framework developers.

```ts
import { installPhoton } from '@photonjs/runtime/vite'
```

## Functions

### `installPhoton(frameworkName, config?)`

Install Photon with framework-specific configuration.

```ts
function installPhoton(
  frameworkName: string,
  config?: RuntimeConfig
): Plugin[]
```

**Parameters:**
- `frameworkName` - Unique identifier for your framework
- `config` - Optional runtime configuration

**Returns:** Array of Vite plugins

**Example:**
```ts
import { installPhoton } from '@photonjs/runtime/vite'

export function myFrameworkPlugin(): Plugin[] {
  return installPhoton('my-framework', {
    fullInstall: true,
    resolveMiddlewares: () => 'my-framework/universal-middleware'
  })
}
```

## Configuration

### `RuntimeConfig`

Configuration interface for framework integration.

```ts
interface RuntimeConfig {
  fullInstall?: boolean
  codeSplitting?: CodeSplittingConfig
  resolveMiddlewares?: () => string
  entries?: Record<string, EntryConfig>
}
```

### `fullInstall`

Enable all Photon features.

```ts
// Enable all features (recommended)
fullInstall: true

// Minimal installation
fullInstall: false
```

### `codeSplitting`

Configure code splitting behavior.

```ts
interface CodeSplittingConfig {
  framework?: boolean
  target?: boolean
}
```

**Example:**
```ts
codeSplitting: {
  framework: false, // Disable framework-level splitting
  target: true      // Enable per-route splitting when supported by target
}
```

### `resolveMiddlewares`

Function that returns the middleware module path.

```ts
// Static middleware path
resolveMiddlewares: () => 'my-framework/universal-middleware'

// Dynamic resolution
resolveMiddlewares: (context) => {
  return context.isDevelopment
    ? 'my-framework/dev-middleware'
    : 'my-framework/prod-middleware'
}
```

### `entries`

Define framework-specific entry points.

```ts
interface EntryConfig {
  id: string
  compositionMode?: 'auto' | 'isolated'
}
```

**Example:**
```ts
entries: {
  standalone: {
    id: 'my-framework/standalone',
    compositionMode: 'isolated'
  },

  api: {
    id: 'my-framework/api'
  }
}
```

## Entry Configuration

### Composition Modes

**`auto` (default):**
Entry is composed with framework middleware from `resolveMiddlewares()`.

**`isolated`:**
Entry runs independently without framework middleware composition.

## Integration Patterns

### Simple Framework

Minimal integration for basic frameworks:

```ts
export function simpleFramework(): Plugin[] {
  return installPhoton('simple', {
    resolveMiddlewares: () => 'simple/middleware'
  })
}
```

### Full-Featured Framework

Refer to [vike-photon](https://github.com/vikejs/vike-photon/blob/main/packages/vike-photon/src/plugin/index.ts) for a complete integration example.

## Examples

### Framework Plugin

```ts
// src/vite/index.ts
import { installPhoton } from '@photonjs/runtime/vite'
import type { Plugin } from 'vite'

export interface FrameworkOptions {
  ssr?: boolean
  api?: boolean
  logging?: boolean
}

export function framework(options: FrameworkOptions = {}): Plugin[] {
  return installPhoton('my-framework', {
    fullInstall: true,

    resolveMiddlewares: () => {
      const middlewares = ['my-framework/core']
      if (options.logging) middlewares.push('my-framework/logging')
      return middlewares
    },

    entries: {
      ...(options.ssr && {
        ssr: { id: 'my-framework/ssr' }
      }),

      ...(options.api && {
        api: { id: 'my-framework/api' }
      })
    }
  })
}
```

### User Integration

```ts
// vite.config.ts
import { framework } from 'my-framework/vite'

export default {
  plugins: [
    framework({
      ssr: true,
      api: true,
      logging: process.env.NODE_ENV === 'development'
    })
  ]
}
```

<NextSteps steps={[
  {
    title: "Framework Integration",
    description: "Learn how to integrate Photon into your framework",
    url: "/guide/framework-integration"
  },
  {
    title: "Universal Middleware",
    description: "Understand framework-agnostic middleware",
    url: "/guide/middleware"
  },
  {
    title: "Core API",
    description: "Check lower-level functions and utilities",
    url: "/api/core"
  }
]} />
